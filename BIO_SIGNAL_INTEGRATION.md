# ç”Ÿç†è¨Šè™Ÿæ•´åˆèªªæ˜

## ğŸ“Š æ•´åˆå®Œæˆï¼

å·²æˆåŠŸå°‡ç”Ÿç†è¨Šè™Ÿè¨˜éŒ„ç³»çµ±æ•´åˆåˆ°æ–°éŸ³æ¨‚å¯¦é©—ä¸­ã€‚

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### **å•Ÿå‹•æ•´åˆç‰ˆç¨‹å¼**

```bash
# ç”Ÿç†è¨Šè™Ÿæ•´åˆç‰ˆ
python3 new_experiment_with_bio.py

# æˆ–ä½¿ç”¨åŸç‰ˆï¼ˆç„¡ç”Ÿç†è¨Šè™Ÿï¼‰
python3 new_experiment.py
```

---

## ğŸ¯ æ•´åˆåŠŸèƒ½èªªæ˜

### **1. è‡ªå‹•åŒ–æµç¨‹**

æ•´åˆç‰ˆæœƒè‡ªå‹•ï¼š
- âœ… åœ¨å¯¦é©—é–‹å§‹æ™‚å•Ÿå‹•ç”Ÿç†è¨Šè™Ÿè¨˜éŒ„
- âœ… åœ¨æ¯å€‹éšæ®µåˆ‡æ›æ™‚è‡ªå‹•æ¨™è¨˜ label
- âœ… åœ¨å¯¦é©—çµæŸæ™‚åœæ­¢è¨˜éŒ„ä¸¦é—œé–‰é€£ç·š
- âœ… ç”Ÿæˆå®Œæ•´çš„ç”Ÿç†è¨Šè™Ÿå’Œäº‹ä»¶æ—¥èªŒ

### **2. éšæ®µæ¨™ç±¤å°æ‡‰**

| é é¢ç´¢å¼• | éšæ®µåç¨± | Label | èªªæ˜ |
|---------|---------|-------|------|
| 0 | åˆå§‹åŒ– | init | å¯¦é©—åˆå§‹åŒ– |
| 1 | Baseline | baseline | Baselineéšæ®µï¼ˆ3åˆ†é˜ï¼‰ |
| 2 | éŸ³æ¨‚1 | music1 | éŸ³æ¨‚1æ’­æ”¾ï¼ˆ5åˆ†é˜ï¼‰ |
| 3 | å•å·1 | questionnaire1 | å•å·1å¡«å¯« |
| 4 | é–“éš”1 | interval1 | é–“éš”ä¼‘æ¯1ï¼ˆè‡³å°‘3åˆ†é˜ï¼‰ |
| 5 | éŸ³æ¨‚2 | music2 | éŸ³æ¨‚2æ’­æ”¾ï¼ˆ5åˆ†é˜ï¼‰ |
| 6 | å•å·2 | questionnaire2 | å•å·2å¡«å¯« |
| 7 | é–“éš”2 | interval2 | é–“éš”ä¼‘æ¯2ï¼ˆè‡³å°‘3åˆ†é˜ï¼‰ |
| 8 | å®Œæˆ | complete | å¯¦é©—å®Œæˆ |

### **3. ç”Ÿç†è¨Šè™Ÿé¡å‹**

è¨˜éŒ„ä»¥ä¸‹ 9 ç¨®ç”Ÿç†è¨Šè™Ÿï¼š

- **GSR** - çš®è†šé›»å°åæ‡‰ (Galvanic Skin Response)
- **HR** - å¿ƒç‡ (Heart Rate)
- **SKT** - çš®è†šæº«åº¦ (Skin Temperature)
- **PPGRAW** - åŸå§‹ PPG è¨Šè™Ÿ (Photoplethysmography Raw)
- **PPI** - è„ˆæé–“æœŸ (Pulse-to-Pulse Interval)
- **ACT** - æ´»å‹•é‡ (Activity)
- **IMUX** - IMU X è»¸åŠ é€Ÿåº¦
- **IMUY** - IMU Y è»¸åŠ é€Ÿåº¦
- **IMUZ** - IMU Z è»¸åŠ é€Ÿåº¦

---

## ğŸ“‚ è¼¸å‡ºæª”æ¡ˆçµæ§‹

### **å¯¦é©—çµæœç›®éŒ„**

```
test_result/P001_S1_GA_BIO_20231115_143022/
  â”œâ”€â”€ experiment_info.json          # å¯¦é©—åƒæ•¸ï¼ˆæ–°å¢ bio_signal_enabled æ¬„ä½ï¼‰
  â”œâ”€â”€ event_log.csv                 # å¯¦é©—éšæ®µæ™‚é–“æˆ³ï¼ˆåŸæœ‰ï¼‰
  â”‚
  â”œâ”€â”€ bio_event_log.csv             # â­ ç”Ÿç†è¨Šè™Ÿæ¨™ç±¤åˆ‡æ›è¨˜éŒ„
  â”‚
  â”œâ”€â”€ bio_result_gsr.csv            # â­ GSR æ•¸æ“š
  â”œâ”€â”€ bio_result_hr.csv             # â­ HR æ•¸æ“š
  â”œâ”€â”€ bio_result_skt.csv            # â­ SKT æ•¸æ“š
  â”œâ”€â”€ bio_result_ppgraw.csv         # â­ PPGRAW æ•¸æ“š
  â”œâ”€â”€ bio_result_ppi.csv            # â­ PPI æ•¸æ“š
  â”œâ”€â”€ bio_result_act.csv            # â­ ACT æ•¸æ“š
  â”œâ”€â”€ bio_result_imux.csv           # â­ IMUX æ•¸æ“š
  â”œâ”€â”€ bio_result_imuy.csv           # â­ IMUY æ•¸æ“š
  â”œâ”€â”€ bio_result_imuz.csv           # â­ IMUZ æ•¸æ“š
  â”‚
  â”œâ”€â”€ music1_evaluation_*.csv       # éŸ³æ¨‚1å•å·
  â””â”€â”€ music2_evaluation_*.csv       # éŸ³æ¨‚2å•å·
```

### **æ–°å¢æª”æ¡ˆèªªæ˜**

#### **bio_event_log.csv** - æ¨™ç±¤åˆ‡æ›è¨˜éŒ„

è¨˜éŒ„æ¯æ¬¡éšæ®µåˆ‡æ›çš„ç²¾ç¢ºæ™‚é–“ï¼š

```csv
Timestamp,Event Type,Label
1699430022.123,LABEL_CHANGE,baseline
1699430202.456,LABEL_CHANGE,music1
1699430502.789,LABEL_CHANGE,questionnaire1
...
```

#### **bio_result_*.csv** - ç”Ÿç†è¨Šè™Ÿæ•¸æ“š

æ‰€æœ‰ç”Ÿç†è¨Šè™Ÿæª”æ¡ˆæ ¼å¼ç›¸åŒï¼š

```csv
Time,Data,Condition,Current,Label
2023-11-15 14:30:22.123,45.2,None,baseline,None
2023-11-15 14:30:23.234,45.3,None,baseline,None
...
```

**æ¬„ä½èªªæ˜**ï¼š
- **Time**: å®¢æˆ¶ç«¯æ™‚é–“æˆ³ï¼ˆæ¯«ç§’ç²¾åº¦ï¼‰
- **Data**: ç”Ÿç†è¨Šè™Ÿæ•¸å€¼
- **Condition**: æ¢ä»¶æ¨™è¨˜ï¼ˆé ç•™ï¼Œç›®å‰ç‚º "None"ï¼‰
- **Current**: ç•¶å‰éšæ®µ label
- **Label**: é¡å¤–æ¨™è¨˜ï¼ˆé ç•™ï¼Œç›®å‰ç‚º "None"ï¼‰

---

## âš™ï¸ ä½¿ç”¨æ–¹å¼

### **æ­¥é©Ÿ1ï¼šå•Ÿå‹•ç¨‹å¼**

```bash
python3 new_experiment_with_bio.py
```

### **æ­¥é©Ÿ2ï¼šè¨­å®šåƒæ•¸**

åœ¨é–‹å§‹é é¢è¨­å®šï¼š
- å—æ¸¬è€…ç·¨è™Ÿ
- Session ç·¨è™Ÿ
- éŸ³æ¨‚é¡åˆ¥
- çµ„åˆ¥ (A/B)
- **å‹¾é¸ã€Œå•Ÿç”¨ç”Ÿç†è¨Šè™Ÿè¨˜éŒ„ã€** â­

### **æ­¥é©Ÿ3ï¼šé€£æ¥ç”Ÿç†è¨Šè™Ÿè¨­å‚™**

ç¨‹å¼æœƒå»ºç«‹ Socket é€£ç·šç­‰å¾…è¨­å‚™ï¼š
- **Host**: `0.0.0.0`
- **Port**: `8000`

ç¢ºä¿ä½ çš„ç”Ÿç†è¨Šè™Ÿè¨­å‚™å·²è¨­å®šç‚ºé€£æ¥æ­¤ä½å€ã€‚

### **æ­¥é©Ÿ4ï¼šåŸ·è¡Œå¯¦é©—**

é»æ“Šã€Œé–‹å§‹å¯¦é©—ã€å¾Œï¼š
- ç¨‹å¼è‡ªå‹•å•Ÿå‹•ç”Ÿç†è¨Šè™Ÿè¨˜éŒ„
- æ¯å€‹éšæ®µåˆ‡æ›æ™‚è‡ªå‹•æ¨™è¨˜ label
- çµ‚ç«¯æœƒé¡¯ç¤ºï¼š`[ç”Ÿç†è¨Šè™Ÿ] æ¨™ç±¤æ›´æ–°ï¼šbaseline (é é¢1)`

### **æ­¥é©Ÿ5ï¼šå¯¦é©—çµæŸ**

å¯¦é©—å®Œæˆå¾Œï¼š
- ç¨‹å¼è‡ªå‹•é—œé–‰ç”Ÿç†è¨Šè™Ÿé€£ç·š
- æ‰€æœ‰æ•¸æ“šå·²ä¿å­˜å®Œæˆ

---

## ğŸ”§ æŠ€è¡“ç´°ç¯€

### **æ•´åˆæ¶æ§‹**

```
NewExperimentWindowWithBio
  â”‚
  â”œâ”€ LabelManager
  â”‚   â””â”€ è¼‰å…¥ experiment_labels.json
  â”‚
  â”œâ”€ BioSignalManager
  â”‚   â””â”€ bioDataUtils (Socket Server)
  â”‚
  â””â”€ EventLogger
      â””â”€ event_log.csv
```

### **é—œéµç¨‹å¼ç¢¼ä½ç½®**

#### **åˆå§‹åŒ–ç”Ÿç†è¨Šè™Ÿ** (`ui/NewExperimentWindowWithBio.py:276`)

```python
def initialize_bio_signal(self):
    self.bio_signal_manager = BioSignalManager(self.label_manager)
    self.bio_signal_manager.start_reading(
        case_path=self.result_dir,
        host="0.0.0.0",
        port=8000
    )
```

#### **æ›´æ–°æ¨™ç±¤** (`ui/NewExperimentWindowWithBio.py:295`)

```python
def update_bio_signal_label(self, page_index: int, phase_name: str):
    label_config = self.label_manager.get_label_for_page(page_index)
    if label_config:
        label = label_config['label']
        self.bio_signal_manager.set_current(label)
        self.bio_signal_manager.mark_label_event(label)
```

#### **æ¯å€‹éšæ®µåˆ‡æ›æ™‚** (ç¯„ä¾‹ï¼š`start_baseline()`)

```python
def start_baseline(self):
    self.current_page_index = 1  # baseline
    self.event_logger.log_phase_start(Phase.BASELINE)
    self.update_bio_signal_label(self.current_page_index, "baseline")  # â­
    # ... é¡¯ç¤ºé é¢
```

---

## ğŸ†š ç‰ˆæœ¬æ¯”è¼ƒ

| åŠŸèƒ½ | åŸç‰ˆ (new_experiment.py) | æ•´åˆç‰ˆ (new_experiment_with_bio.py) |
|------|--------------------------|-------------------------------------|
| å¯¦é©—æµç¨‹ | âœ… å®Œæ•´ | âœ… å®Œæ•´ |
| EventLogger | âœ… | âœ… |
| å•å·è¨˜éŒ„ | âœ… | âœ… |
| ç”Ÿç†è¨Šè™Ÿè¨˜éŒ„ | âŒ | âœ… å¯é¸ |
| è‡ªå‹•æ¨™è¨˜ label | âŒ | âœ… |
| ç”Ÿç†è¨Šè™Ÿæ™‚é–“æˆ³ | âŒ | âœ… |
| çµæœç›®éŒ„å‘½å | `P001_S1_GA_*` | `P001_S1_GA_BIO_*` ï¼ˆå•Ÿç”¨æ™‚ï¼‰ |

---

## ğŸ“Š è³‡æ–™åˆ†æå»ºè­°

### **æ™‚é–“å°é½Š**

1. **event_log.csv** - å¯¦é©—éšæ®µç²¾ç¢ºæ™‚é–“
2. **bio_event_log.csv** - æ¨™ç±¤åˆ‡æ›æ™‚é–“
3. **bio_result_*.csv** - ç”Ÿç†è¨Šè™Ÿæ•¸æ“šï¼ˆåŒ…å« Current æ¬„ä½ï¼‰

### **åˆ†æç¯„ä¾‹**

```python
import pandas as pd

# è¼‰å…¥ GSR æ•¸æ“š
gsr_df = pd.read_csv('bio_result_gsr.csv')

# ç¯©é¸ baseline éšæ®µçš„ GSR
baseline_gsr = gsr_df[gsr_df['Current'] == 'baseline']

# è¨ˆç®—å¹³å‡å€¼
baseline_mean = baseline_gsr['Data'].mean()
print(f"Baseline GSR å¹³å‡å€¼: {baseline_mean}")

# è¼‰å…¥æ¨™ç±¤åˆ‡æ›è¨˜éŒ„
events_df = pd.read_csv('bio_event_log.csv')

# å–å¾— baseline é–‹å§‹æ™‚é–“
baseline_start = events_df[events_df['Label'] == 'baseline']['Timestamp'].iloc[0]
```

---

## âš ï¸ æ³¨æ„äº‹é …

### **1. ç”Ÿç†è¨Šè™Ÿè¨­å‚™è¨­å®š**

ç¢ºä¿ä½ çš„ç”Ÿç†è¨Šè™Ÿè¨­å‚™ï¼š
- æ”¯æ´ Socket é€£ç·š
- è¨­å®šé€£æ¥åˆ° `0.0.0.0:8000`
- å‚³é€ JSON æ ¼å¼è³‡æ–™ï¼ˆåƒè€ƒ `bioDataUtils.py:284-387`ï¼‰

### **2. ç¶²è·¯è¨­å®š**

- é è¨­ç›£è½æ‰€æœ‰ç¶²è·¯ä»‹é¢ (`0.0.0.0`)
- å¦‚éœ€é™åˆ¶ï¼Œä¿®æ”¹ `ExperimentConfig.bio_signal_host`
- Port 8000 éœ€ç¢ºä¿æœªè¢«ä½”ç”¨

### **3. é™¤éŒ¯æ¨¡å¼**

é™¤éŒ¯æ¨¡å¼ä¸‹ï¼š
- å¯å¿«é€Ÿè·³éå„éšæ®µ
- ç”Ÿç†è¨Šè™ŸåŠŸèƒ½æ­£å¸¸é‹ä½œ
- é©åˆæ¸¬è©¦æ¨™ç±¤åˆ‡æ›

### **4. å¯é¸åŠŸèƒ½**

ç”Ÿç†è¨Šè™Ÿè¨˜éŒ„æ˜¯**å¯é¸çš„**ï¼š
- é–‹å§‹é é¢å¯å‹¾é¸å•Ÿç”¨/é—œé–‰
- é—œé–‰æ™‚ä¸å½±éŸ¿å¯¦é©—æµç¨‹
- å•Ÿç”¨å¤±æ•—æ™‚æœƒé¡¯ç¤ºè­¦å‘Šä½†å¯¦é©—ç¹¼çºŒ

---

## ğŸ” æ•…éšœæ’é™¤

### **å•é¡Œ1ï¼šç„¡æ³•é€£æ¥ç”Ÿç†è¨Šè™Ÿè¨­å‚™**

**ç—‡ç‹€**ï¼šç¨‹å¼é¡¯ç¤ºã€Œç­‰å¾…é€£ç·šæ–¼ 0.0.0.0:8000ã€

**è§£æ±ºæ–¹æ³•**ï¼š
1. ç¢ºèªè¨­å‚™å·²é–‹å•Ÿä¸¦è¨­å®šæ­£ç¢º IP/Port
2. æª¢æŸ¥é˜²ç«ç‰†è¨­å®š
3. æ¸¬è©¦ä½¿ç”¨ `telnet 0.0.0.0 8000`

### **å•é¡Œ2ï¼šæ¨™ç±¤æ²’æœ‰æ›´æ–°**

**ç—‡ç‹€**ï¼šCSV æª”æ¡ˆä¸­ Current æ¬„ä½éƒ½æ˜¯ "None"

**è§£æ±ºæ–¹æ³•**ï¼š
1. æª¢æŸ¥ `experiment_labels.json` æ˜¯å¦å­˜åœ¨
2. ç¢ºèª `labels/` ç›®éŒ„å®Œæ•´
3. æŸ¥çœ‹çµ‚ç«¯æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯

### **å•é¡Œ3ï¼šç”Ÿç†è¨Šè™Ÿæª”æ¡ˆæœªç”¢ç”Ÿ**

**ç—‡ç‹€**ï¼šçµæœç›®éŒ„ä¸­æ²’æœ‰ `bio_result_*.csv`

**è§£æ±ºæ–¹æ³•**ï¼š
1. ç¢ºèªã€Œå•Ÿç”¨ç”Ÿç†è¨Šè™Ÿè¨˜éŒ„ã€å·²å‹¾é¸
2. ç¢ºèªè¨­å‚™å·²æˆåŠŸé€£æ¥
3. æª¢æŸ¥çµ‚ç«¯æ˜¯å¦æœ‰ `[ç”Ÿç†è¨Šè™Ÿ]` ç›¸é—œè¨Šæ¯

---

## ğŸ“ ä¿®æ”¹é…ç½®

### **ä¿®æ”¹ Socket é€£ç·šè¨­å®š**

ç·¨è¼¯ `ui/NewExperimentWindowWithBio.py:29-31`ï¼š

```python
class ExperimentConfig:
    # ç”Ÿç†è¨Šè™Ÿè¨­å®š
    bio_signal_host = "0.0.0.0"  # ä¿®æ”¹ç‚ºç‰¹å®š IP
    bio_signal_port = 8000       # ä¿®æ”¹ Port
```

### **ä¿®æ”¹éšæ®µæ¨™ç±¤**

ç·¨è¼¯ `labels/experiment_labels.json`ï¼š

```json
{
  "page": 1,
  "label": "baseline",
  "description": "Baseline éšæ®µï¼ˆ3åˆ†é˜ï¼‰"
}
```

---

## âœ… æ¸¬è©¦æª¢æŸ¥æ¸…å–®

åŸ·è¡Œå®Œæ•´æ¸¬è©¦æ™‚ï¼Œè«‹ç¢ºèªï¼š

- [ ] ç¨‹å¼å•Ÿå‹•æˆåŠŸ
- [ ] é–‹å§‹é é¢å‹¾é¸ã€Œå•Ÿç”¨ç”Ÿç†è¨Šè™Ÿè¨˜éŒ„ã€
- [ ] çµ‚ç«¯é¡¯ç¤ºã€Œå·²åˆå§‹åŒ–ï¼Œç­‰å¾…é€£ç·šã€
- [ ] è¨­å‚™æˆåŠŸé€£æ¥ï¼ˆçµ‚ç«¯é¡¯ç¤º "Connected by"ï¼‰
- [ ] æ¯å€‹éšæ®µåˆ‡æ›æ™‚é¡¯ç¤ºã€Œæ¨™ç±¤æ›´æ–°ã€è¨Šæ¯
- [ ] å¯¦é©—çµæŸå¾Œé¡¯ç¤ºã€Œå·²é—œé–‰è¨˜éŒ„ã€
- [ ] çµæœç›®éŒ„ä¸­åŒ…å«æ‰€æœ‰ `bio_result_*.csv`
- [ ] çµæœç›®éŒ„ä¸­åŒ…å« `bio_event_log.csv`
- [ ] CSV æª”æ¡ˆä¸­ Current æ¬„ä½æ­£ç¢ºé¡¯ç¤ºéšæ®µ label

---

## ğŸ‰ æ•´åˆå®Œæˆ

ç”Ÿç†è¨Šè™Ÿå·²å®Œå…¨æ•´åˆåˆ°æ–°å¯¦é©—ç³»çµ±ï¼

**æœ‰ä»»ä½•å•é¡Œæˆ–éœ€è¦èª¿æ•´ï¼Œè«‹éš¨æ™‚å‘ŠçŸ¥ã€‚** ğŸš€
